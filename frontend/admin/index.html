<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –ë–¢–Ü</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; display: flex; background: #f4f7f6; color: #333; height: 100vh;}
        
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1e293b; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .login-card { background: white; padding: 40px; border-radius: 10px; width: 100%; max-width: 350px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .login-card h2 { text-align: center; margin-bottom: 25px; color: #0f172a; }
        
        #app-screen { display: none; width: 100%; height: 100%; }
        .sidebar { width: 260px; background: #1e293b; color: white; padding: 20px; display: flex; flex-direction: column; flex-shrink: 0;}
        .sidebar h2 { font-size: 20px; margin-bottom: 30px; color: #38bdf8; text-align: center; }
        .sidebar button { background: transparent; color: #cbd5e1; border: none; text-align: left; padding: 12px 15px; margin-bottom: 8px; border-radius: 6px; cursor: pointer; font-size: 16px; width: 100%; transition: 0.2s; }
        .sidebar button:hover, .sidebar button.active { background: #334155; color: white; }
        .sidebar .site-link { margin-top: auto; background: #0f172a; text-align: center; text-decoration: none; color: white; padding: 12px; border-radius: 6px;}
        
        .content { flex-grow: 1; padding: 40px; overflow-y: auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px;}
        .card h3 { margin-bottom: 15px; font-size: 18px; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; }
        
        input[type="text"], input[type="password"], input[type="date"], input[type="url"], select, textarea { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-family: inherit; font-size: 15px; margin-bottom: 15px; }        textarea { height: 100px; resize: vertical; }
        button.action-btn { background: #0ea5e9; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 10px; width: 100%;}
        button.action-btn:hover { background: #0284c7; }
        button.del-btn { background: #ef4444; padding: 6px 12px; font-size: 13px; float: right; margin-top: 0; width: auto;}
        button.add-row-btn { background: #10b981; padding: 8px 15px; width: auto; }
        
        .price-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .price-row input { margin-bottom: 0; }
        .price-row .col-name { flex: 2; }
        .price-row .col-price { flex: 1; }
        .price-row.header-row input { font-weight: bold; background: #f8fafc; }
        
        .list-item { border: 1px solid #e2e8f0; padding: 15px; border-radius: 6px; margin-bottom: 10px; background: #f8fafc;}
        #status-msg { margin-top: 15px; padding: 10px; border-radius: 6px; display: none; font-weight: 500; background: #dcfce7; color: #166534; }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ Quill */
        .ql-container { font-family: 'Inter', sans-serif; font-size: 15px; background: white; border-radius: 0 0 6px 6px; }
        .ql-toolbar { border-radius: 6px 6px 0 0; background: #f8fafc; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h2>–í—Ö—ñ–¥ –≤ –ê–¥–º—ñ–Ω–∫—É</h2>
            <form id="login-form">
                <input type="text" id="username" placeholder="–õ–æ–≥—ñ–Ω (admin)" required>
                <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å (admin2026)" required>
                <button type="submit" class="action-btn">–£–≤—ñ–π—Ç–∏</button>
                <div id="login-error" style="color: #ef4444; margin-top: 10px; display: none; text-align: center; font-size: 14px;">–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ</div>
            </form>
        </div>
    </div>

    <div id="app-screen">
        <div class="sidebar">
            <h2>–ë–¢–Ü –ê–¥–º—ñ–Ω</h2>
            <button onclick="openTab('tab-hero')" class="active">–ì–æ–ª–æ–≤–Ω–∞ (–¢–µ–∫—Å—Ç)</button>
            <button onclick="openTab('tab-faq')">–ß–∞—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è (FAQ)</button>
            <button onclick="openTab('tab-services')">–ü–æ—Å–ª—É–≥–∏ —Ç–∞ –¶—ñ–Ω–∏</button>
            <button onclick="openTab('tab-news')">–ù–æ–≤–∏–Ω–∏ (–ë–ª–æ–≥)</button>
            <button onclick="logout()" style="margin-top: 20px; color: #ef4444;">üö™ –í–∏–π—Ç–∏</button>
            <button onclick="openTab('tab-contacts')">–ö–æ–Ω—Ç–∞–∫—Ç–∏</button>
            <a href="../index.html" target="_blank" class="site-link">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç ‚Üó</a>
        </div>

        <div class="content">
            <div id="status-msg"></div>

            <div id="tab-hero" class="tab-content active">
                <h1>–¢–µ–∫—Å—Ç –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π</h1>
                <div class="card"><form id="hero-form"><textarea id="hero-text" required></textarea><button type="submit" class="action-btn" style="width: auto;">–ó–±–µ—Ä–µ–≥—Ç–∏</button></form></div>
            </div>

            <div id="tab-faq" class="tab-content">
                <h1>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è FAQ</h1>
                <div class="card"><form id="faq-form"><input type="text" id="faq-q" placeholder="–ü–∏—Ç–∞–Ω–Ω—è" required><textarea id="faq-a" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å" required></textarea><button type="submit" class="action-btn" style="width: auto;">–î–æ–¥–∞—Ç–∏</button></form></div>
                <div class="card"><div id="faq-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div></div>
            </div>

            <div id="tab-services" class="tab-content">
                <h1>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ü—ñ–Ω–∞–º–∏</h1>
                <div class="card">
                    <h3>–û–±–µ—Ä—ñ—Ç—å –ø–æ—Å–ª—É–≥—É</h3>
                    <select id="service-select" onchange="loadServiceData()">
                        <option value="" disabled selected>-- –û–±–µ—Ä—ñ—Ç—å –ø–æ—Å–ª—É–≥—É --</option>
                        <optgroup label="–¢–µ—Ö–Ω—ñ—á–Ω–∏–π –ø–∞—Å–ø–æ—Ä—Ç">
                            <option value="tehpasport-kvartyra">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É</option>
                            <option value="tehpasport-budynok">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –∂–∏–ª–∏–π –±—É–¥–∏–Ω–æ–∫</option>
                            <option value="tehpasport-garazh">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –≥–∞—Ä–∞–∂</option>
                            <option value="tehpasport-dacha">–ù–∞ –¥–∞—á—É –∞–±–æ —Å–∞–¥–æ–≤–∏–π –±—É–¥–∏–Ω–æ–∫</option>
                            <option value="tehpasport-vvedennya">–ù–∞ –±—É–¥–∏–Ω–æ–∫ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –≤ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é</option>
                            <option value="tehpasport-nezhyle">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –Ω–µ–∂–∏–ª–µ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è</option>
                            <option value="tehpasport-vyrobnychi">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –≤–∏—Ä–æ–±–Ω–∏—á—ñ –±—É–¥—ñ–≤–ª—ñ</option>
                        </optgroup>
                        <optgroup label="–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫">
                            <option value="tehpasport-pereplanuvannya-kvartyra">–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∫–≤–∞—Ä—Ç–∏—Ä–∏</option>
                            <option value="tehpasport-pereplanuvannya-budynok">–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –±—É–¥–∏–Ω–∫—É</option>
                            <option value="tehpasport-pereplanuvannya-vyrobnychi">–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –≤–∏—Ä–æ–±–Ω–∏—á–æ—ó –±—É–¥—ñ–≤–ª—ñ</option>
                            <option value="tehpasport-pereplanuvannya-nezhyle">–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –Ω–µ–∂–∏–ª–æ–≥–æ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è</option>
                        </optgroup>
                        <optgroup label="–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ—Å–ª—É–≥–∏">
                            <option value="ocinka">–û—Ü—ñ–Ω–∫–∞ –Ω–µ—Ä—É—Ö–æ–º–æ–≥–æ –º–∞–π–Ω–∞</option>
                            <option value="budivelnyi-pasport">–ë—É–¥—ñ–≤–µ–ª—å–Ω–∏–π –ø–∞—Å–ø–æ—Ä—Ç</option>
                            <option value="tehnichne-obstezhennya">–¢–µ—Ö–Ω—ñ—á–Ω–µ –æ–±—Å—Ç–µ–∂–µ–Ω–Ω—è –±—É–¥—ñ–≤–µ–ª—å —Ç–∞ —Å–ø–æ—Ä—É–¥</option>
                            <option value="perevedennya-dachnogo">–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è –¥–∞—á–Ω–æ–≥–æ –±—É–¥–∏–Ω–∫—É –≤ –∂–∏–ª–∏–π</option>
                        </optgroup>
                    </select>
                </div>
                <div class="card" id="table-editor" style="display: none;">
                    <h3>–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–∞–±–ª–∏—Ü—ñ</h3>
                    <input type="text" id="service-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
                    <div id="table-container"></div>
                    <button type="button" class="action-btn add-row-btn" onclick="addTableRow('', '')">+ –î–æ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫</button>
                    <hr style="margin: 20px 0; border: 0; border-top: 1px solid #e2e8f0;">
                    <button type="button" class="action-btn" style="width: auto;" onclick="saveServiceData()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–∞–±–ª–∏—Ü—é</button>
                </div>
            </div>

            <div id="tab-news" class="tab-content">
                <h1>–ë–ª–æ–≥ —Ç–∞ –ù–æ–≤–∏–Ω–∏</h1>
                
                <div class="card">
                    <h3>–î–æ–¥–∞—Ç–∏ –Ω–æ–≤—É —Å—Ç–∞—Ç—Ç—é</h3>
                    <form id="news-form">
                        <input type="text" id="news-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—Ç—ñ (–Ω–∞–ø—Ä. –Ø–∫ —É–∑–∞–∫–æ–Ω–∏—Ç–∏ –ø—Ä–∏–±—É–¥–æ–≤—É?)" required>
                        
                        <div style="display: flex; gap: 15px;">
                            <input type="date" id="news-date" required>
                            <select id="news-tag" required>
                                <option value="" disabled selected>-- –û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é --</option>
                                <option value="–ù–æ–≤–∏–Ω–∞">–ù–æ–≤–∏–Ω–∞</option>
                                <option value="–ü–æ—Ä–∞–¥–∞">–ö–æ—Ä–∏—Å–Ω–∞ –ø–æ—Ä–∞–¥–∞</option>
                                <option value="–ü–æ–¥—ñ—è">–ü–æ–¥—ñ—è</option>
                            </select>
                        </div>
                        
                        <input type="url" id="news-image" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É (URL)" required>
                        <textarea id="news-preview" placeholder="–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –¥–ª—è –∫–∞—Ä—Ç–∫–∏ –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ (2-3 —Ä–µ—á–µ–Ω–Ω—è)" required></textarea>
                        
                        <label style="display:block; margin-bottom: 8px; font-weight: 600; color: #334155;">–ü–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—Ç—ñ:</label>
                        <div id="quill-editor" style="height: 300px; margin-bottom: 20px;"></div>
                        
                        <button type="submit" class="action-btn" style="width: auto;">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏ –Ω–æ–≤–∏–Ω—É</button>
                    </form>
                </div>

                <div class="card">
                    <h3>–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ –Ω–æ–≤–∏–Ω–∏</h3>
                    <div id="news-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
                </div>
                <div id="tab-contacts" class="tab-content">
                <h1>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h1>
                <div class="card">
                    <form id="contacts-form">
                        <label>–ê–¥—Ä–µ—Å–∞:</label>
                        <input type="text" id="c-address" placeholder="—Å. –§—É—Ä—Å–∏, –≤—É–ª. ...">

                        <div style="display: flex; gap: 15px;">
                            <div style="flex: 1;">
                                <label>–¢–µ–ª–µ—Ñ–æ–Ω (–¥–ª—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è, –±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤):</label>
                                <input type="text" id="c-phone-raw" placeholder="+380980000000">
                            </div>
                            <div style="flex: 1;">
                                <label>–¢–µ–ª–µ—Ñ–æ–Ω (–¥–ª—è –ø–æ–∫–∞–∑—É –Ω–∞ –µ–∫—Ä–∞–Ω—ñ):</label>
                                <input type="text" id="c-phone-display" placeholder="(098) 000-00-00">
                            </div>
                        </div>

                        <label>Email:</label>
                        <input type="text" id="c-email" placeholder="example@gmail.com">

                        <p style="margin-top: 20px; font-size: 14px; color: #666;" id="var-schedule">
                            –ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏:<br>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...
                        </p>

                        <div style="display: flex; gap: 15px;">
                            <div style="flex: 1;">
                                <label>Telegram (URL):</label>
                                <input type="url" id="c-telegram" placeholder="https://t.me/...">
                            </div>
                            <div style="flex: 1;">
                                <label>Viber (URL):</label>
                                <input type="text" id="c-viber" placeholder="viber://chat?number=...">
                            </div>
                        </div>

            <button type="submit" class="action-btn" style="width: auto; margin-top: 20px;">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∏</button>
        </form>
    </div>
</div>
            </div>

        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000/api';
        
        // --- –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø QUILL.JS (–í—ñ–∑—É–∞–ª—å–Ω–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä) ---
        var quill = new Quill('#quill-editor', {
            theme: 'snow',
            placeholder: '–ù–∞–ø–∏—à—ñ—Ç—å –≤–∞—à—É —Å—Ç–∞—Ç—Ç—é —Ç—É—Ç...',
            modules: {
                toolbar: [
                    [{ 'header': [2, 3, false] }],
                    ['bold', 'italic', 'underline'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['link'],
                    ['clean'] // –∫–Ω–æ–ø–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è
                ]
            }
        });

        // --- –ê–í–¢–û–†–ò–ó–ê–¶–Ü–Ø ---
        function checkAuth() {
            const token = localStorage.getItem('bti_token');
            if (token) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app-screen').style.display = 'flex';
                loadInitialData();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('app-screen').style.display = 'none';
            }
        }
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            try {
                const res = await fetch(`${API_URL}/login`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ username: u, password: p }) });
                if (res.ok) {
                    const data = await res.json();
                    localStorage.setItem('bti_token', data.access_token);
                    document.getElementById('login-error').style.display = 'none';
                    checkAuth();
                } else document.getElementById('login-error').style.display = 'block';
            } catch(err) { console.error(err); }
        });
        function logout() { localStorage.removeItem('bti_token'); checkAuth(); }

        async function fetchProtected(url, options = {}) {
            const token = localStorage.getItem('bti_token');
            options.headers = { ...options.headers, 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };
            const response = await fetch(url, options);
            if (response.status === 401) { logout(); alert("–°–µ—Å—ñ—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –£–≤—ñ–π–¥—ñ—Ç—å –∑–Ω–æ–≤—É."); throw new Error("Unauthorized"); }
            return response;
        }

        // --- –Ü–ù–¢–ï–†–§–ï–ô–° –¢–ê –ù–ê–í–Ü–ì–ê–¶–Ü–Ø ---
        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sidebar button').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            if (tabId === 'tab-faq') loadFaqs();
            if (tabId === 'tab-news') loadNews();
            if (tabId === 'tab-contacts') loadContacts();
        }

        function showStatus(msg, isError = false) {
            const el = document.getElementById('status-msg');
            el.textContent = msg; 
            el.style.backgroundColor = isError ? '#fee2e2' : '#dcfce7';
            el.style.color = isError ? '#991b1b' : '#166534';
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        async function loadInitialData() {
            const res = await fetch(`${API_URL}/settings/hero`);
            const data = await res.json();
            document.getElementById('hero-text').value = data.subtitle;
        }
        
        async function loadContacts() {
        const res = await fetch(`${API_URL}/settings`);
        const s = await res.json();
        document.getElementById('c-address').value = s.address || '';
        document.getElementById('c-phone-raw').value = s.phone1_raw || '';
        document.getElementById('c-phone-display').value = s.phone1_display || '';
        document.getElementById('c-email').value = s.email || '';
        document.getElementById('c-schedule').value = s.schedule || '';
        document.getElementById('c-telegram').value = s.telegram || '';
        document.getElementById('c-viber').value = s.viber || '';
            }

            document.getElementById('contacts-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const data = {
                    settings: {
                        address: document.getElementById('c-address').value,
                        phone1_raw: document.getElementById('c-phone-raw').value,
                        phone1_display: document.getElementById('c-phone-display').value,
                        email: document.getElementById('c-email').value,
                        schedule: document.getElementById('c-schedule').value,
                        telegram: document.getElementById('c-telegram').value,
                        viber: document.getElementById('c-viber').value
                    }
                };
                try {
                    await fetchProtected(`${API_URL}/settings/bulk-update`, {
                        method: 'POST',
                        body: JSON.stringify(data)
                    });
                    showStatus('–ö–æ–Ω—Ç–∞–∫—Ç–∏ —É—Å–ø—ñ—à–Ω–æ –æ–Ω–æ–≤–ª–µ–Ω–æ!');
                } catch(e) { showStatus('–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è', true); }
            });
                document.getElementById('hero-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    try { await fetchProtected(`${API_URL}/settings/hero/update`, { method: 'POST', body: JSON.stringify({ subtitle: document.getElementById('hero-text').value }) }); showStatus('–¢–µ–∫—Å—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–æ!'); } catch(e) {}
                });

        // --- FAQ ---
        async function loadFaqs() {
            const res = await fetch(`${API_URL}/faqs`);
            const faqs = await res.json();
            const list = document.getElementById('faq-list');
            list.innerHTML = '';
            faqs.forEach(f => { list.innerHTML += `<div class="list-item"><button class="action-btn del-btn" onclick="deleteFaq(${f.id})">–í–∏–¥–∞–ª–∏—Ç–∏</button><strong>${f.question}</strong><p>${f.answer}</p></div>`; });
        }
        document.getElementById('faq-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            try { await fetchProtected(`${API_URL}/faqs`, { method: 'POST', body: JSON.stringify({ question: document.getElementById('faq-q').value, answer: document.getElementById('faq-a').value }) }); document.getElementById('faq-q').value = ''; document.getElementById('faq-a').value = ''; showStatus('–ü–∏—Ç–∞–Ω–Ω—è –¥–æ–¥–∞–Ω–æ!'); loadFaqs(); } catch(e) {}
        });
        async function deleteFaq(id) { if(confirm("–¢–æ—á–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏?")) { try { await fetchProtected(`${API_URL}/faqs/${id}`, { method: 'DELETE' }); showStatus('–í–∏–¥–∞–ª–µ–Ω–æ!'); loadFaqs(); } catch(e) {} } }

        // --- –ü–û–°–õ–£–ì–ò –¢–ê –¶–Ü–ù–ò ---
        let currentSlug = '';
        async function loadServiceData() {
            currentSlug = document.getElementById('service-select').value;
            if(!currentSlug) return;
            document.getElementById('table-editor').style.display = 'block';
            const res = await fetch(`${API_URL}/services/${currentSlug}`);
            const data = await res.json();
            document.getElementById('service-title').value = data.title;
            const container = document.getElementById('table-container');
            container.innerHTML = ''; 
            const tableData = data.table_data && data.table_data.length > 0 ? data.table_data : [["–ü–æ—Å–ª—É–≥–∞", "–¶—ñ–Ω–∞"]];
            tableData.forEach((row, index) => addTableRow(row[0], row[1], index === 0));
        }
        function addTableRow(col1Val = '', col2Val = '', isHeader = false) {
            const container = document.getElementById('table-container');
            const rowDiv = document.createElement('div');
            rowDiv.className = `price-row ${isHeader ? 'header-row' : ''}`;
            rowDiv.innerHTML = `<input type="text" class="col-name" value="${col1Val}" placeholder="${isHeader ? '–ù–∞–∑–≤–∞ –∫–æ–ª–æ–Ω–∫–∏ 1' : '–ù–∞–∑–≤–∞ –ø–æ—Å–ª—É–≥–∏'}"><input type="text" class="col-price" value="${col2Val}" placeholder="${isHeader ? '–ù–∞–∑–≤–∞ –∫–æ–ª–æ–Ω–∫–∏ 2' : '–¶—ñ–Ω–∞'}">${!isHeader ? '<button type="button" class="action-btn del-btn" onclick="this.parentElement.remove()">X</button>' : '<div style="width: 44px;"></div>'}`;
            container.appendChild(rowDiv);
        }
        async function saveServiceData() {
            const title = document.getElementById('service-title').value;
            const rows = document.querySelectorAll('.price-row');
            const tableData = [];
            rows.forEach(row => tableData.push([row.querySelector('.col-name').value, row.querySelector('.col-price').value]));
            try { await fetchProtected(`${API_URL}/services/${currentSlug}`, { method: 'POST', body: JSON.stringify({ title: title, table_data: tableData }) }); showStatus('–¢–∞–±–ª–∏—Ü—é —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –±–∞–∑—ñ!'); } catch (error) { showStatus('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è', true); }
        }

        // --- –ù–û–í–ò–ù–ò ---
        async function loadNews() {
            try {
                const res = await fetch(`${API_URL}/news`);
                const newsList = await res.json();
                const list = document.getElementById('news-list');
                list.innerHTML = '';
                if (newsList.length === 0) list.innerHTML = '<p>–ù–æ–≤–∏–Ω –ø–æ–∫–∏ –Ω–µ–º–∞—î.</p>';
                newsList.forEach(n => { 
                    list.innerHTML += `<div class="list-item">
                        <button class="action-btn del-btn" onclick="deleteNews(${n.id})">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                        <strong>${n.title}</strong> <span style="color:#64748b; font-size:13px; margin-left: 10px;">üïí ${n.date_str}</span>
                        <div style="font-size: 13px; color: #0ea5e9; margin-top: 5px;">#${n.tag}</div>
                    </div>`; 
                });
            } catch(e) { console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–æ–≤–∏–Ω", e); }
        }

        document.getElementById('news-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // –û—Ç—Ä–∏–º—É—î–º–æ HTML –∫–æ–¥ —Å—Ç–∞—Ç—Ç—ñ –∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ Quill
            const articleContent = quill.root.innerHTML;
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –Ω–µ –ø–æ—Ä–æ–∂–Ω—ñ–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
            if (quill.getText().trim().length === 0) {
                alert("–¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—Ç—ñ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–º!");
                return;
            }

            // –§–æ—Ä–º–∞—Ç—É—î–º–æ –¥–∞—Ç—É –∑ YYYY-MM-DD —É DD.MM.YYYY
            const dateInput = document.getElementById('news-date').value;
            const [y, m, d] = dateInput.split('-');
            const formattedDate = `${d}.${m}.${y}`;

            const newsData = {
                title: document.getElementById('news-title').value,
                date_str: formattedDate,
                tag: document.getElementById('news-tag').value,
                image_url: document.getElementById('news-image').value,
                preview: document.getElementById('news-preview').value,
                content: articleContent
            };

            try {
                await fetchProtected(`${API_URL}/news`, {
                    method: 'POST',
                    body: JSON.stringify(newsData)
                });
                
                showStatus('–ù–æ–≤–∏–Ω—É —É—Å–ø—ñ—à–Ω–æ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ!');
                document.getElementById('news-form').reset();
                quill.root.innerHTML = ''; // –û—á–∏—â–∞—î–º–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä
                loadNews(); // –û–Ω–æ–≤–ª—é—î–º–æ —Å–ø–∏—Å–æ–∫
            } catch(err) {
                showStatus('–ü–æ–º–∏–ª–∫–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó', true);
            }
        });

        async function deleteNews(id) {
            if(confirm("–í–∏ –¥—ñ–π—Å–Ω–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –Ω–æ–≤–∏–Ω—É/—Å—Ç–∞—Ç—Ç—é?")) {
                try {
                    await fetchProtected(`${API_URL}/news/${id}`, { method: 'DELETE' });
                    showStatus('–ù–æ–≤–∏–Ω—É –≤–∏–¥–∞–ª–µ–Ω–æ!');
                    loadNews();
                } catch(e) {}
            }
        }

        checkAuth();
    </script>
</body>
</html>