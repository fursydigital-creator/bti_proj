<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –ë–¢–Ü</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; display: flex; background: #f4f7f6; color: #333; height: 100vh;}
        .sidebar { width: 260px; background: #1e293b; color: white; padding: 20px; display: flex; flex-direction: column; }
        .sidebar h2 { font-size: 20px; margin-bottom: 30px; color: #38bdf8; text-align: center; }
        .sidebar button { background: transparent; color: #cbd5e1; border: none; text-align: left; padding: 12px 15px; margin-bottom: 8px; border-radius: 6px; cursor: pointer; font-size: 16px; width: 100%; transition: 0.2s; }
        .sidebar button:hover, .sidebar button.active { background: #334155; color: white; }
        .sidebar .site-link { margin-top: auto; background: #0f172a; text-align: center; text-decoration: none; color: white; padding: 12px; border-radius: 6px;}
        
        .content { flex-grow: 1; padding: 40px; overflow-y: auto; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        .card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px;}
        .card h3 { margin-bottom: 15px; font-size: 18px; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; }
        
        input[type="text"], select, textarea { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-family: inherit; font-size: 15px; margin-bottom: 15px; }
        textarea { height: 100px; resize: vertical; }
        button.action-btn { background: #0ea5e9; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 10px;}
        button.action-btn:hover { background: #0284c7; }
        button.del-btn { background: #ef4444; padding: 6px 12px; font-size: 13px; float: right; margin-top: 0;}
        button.add-row-btn { background: #10b981; padding: 8px 15px; }
        
        .price-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .price-row input { margin-bottom: 0; }
        .price-row .col-name { flex: 2; }
        .price-row .col-price { flex: 1; }
        .price-row.header-row input { font-weight: bold; background: #f8fafc; }
        
        .faq-list-item { border: 1px solid #e2e8f0; padding: 15px; border-radius: 6px; margin-bottom: 10px; }
        #status-msg { margin-top: 15px; padding: 10px; border-radius: 6px; display: none; font-weight: 500; background: #dcfce7; color: #166534; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>–ë–¢–Ü –ê–¥–º—ñ–Ω</h2>
        <button onclick="openTab('tab-hero')" class="active">–ì–æ–ª–æ–≤–Ω–∞ (–¢–µ–∫—Å—Ç)</button>
        <button onclick="openTab('tab-faq')">–ß–∞—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è (FAQ)</button>
        <button onclick="openTab('tab-services')">–ü–æ—Å–ª—É–≥–∏ —Ç–∞ –¶—ñ–Ω–∏</button>
        <a href="../index.html" target="_blank" class="site-link">–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç ‚Üó</a>
    </div>

    <div class="content">
        <div id="status-msg"></div>

        <div id="tab-hero" class="tab-content active">
            <h1>–¢–µ–∫—Å—Ç –Ω–∞ –≥–æ–ª–æ–≤–Ω—ñ–π</h1>
            <div class="card"><form id="hero-form"><textarea id="hero-text" required></textarea><button type="submit" class="action-btn">–ó–±–µ—Ä–µ–≥—Ç–∏</button></form></div>
        </div>

        <div id="tab-faq" class="tab-content">
            <h1>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è FAQ</h1>
            <div class="card"><form id="faq-form"><input type="text" id="faq-q" placeholder="–ü–∏—Ç–∞–Ω–Ω—è" required><textarea id="faq-a" placeholder="–í—ñ–¥–ø–æ–≤—ñ–¥—å" required></textarea><button type="submit" class="action-btn">–î–æ–¥–∞—Ç–∏</button></form></div>
            <div class="card"><div id="faq-list">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div></div>
        </div>

        <div id="tab-services" class="tab-content">
            <h1>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ü—ñ–Ω–∞–º–∏</h1>
            
            <div class="card">
                <h3>–û–±–µ—Ä—ñ—Ç—å —Å—Ç–æ—Ä—ñ–Ω–∫—É –¥–ª—è —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è</h3>
                <select id="service-select" onchange="loadServiceData()">
                    <option value="" disabled selected>-- –û–±–µ—Ä—ñ—Ç—å –ø–æ—Å–ª—É–≥—É --</option>
                    <optgroup label="–¢–µ—Ö–Ω—ñ—á–Ω–∏–π –ø–∞—Å–ø–æ—Ä—Ç">
                        <option value="tehpasport-kvartyra">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É</option>
                        <option value="tehpasport-budynok">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –∂–∏–ª–∏–π –±—É–¥–∏–Ω–æ–∫</option>
                        <option value="tehpasport-garazh">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –≥–∞—Ä–∞–∂</option>
                        <option value="tehpasport-dacha">–ù–∞ –¥–∞—á—É –∞–±–æ —Å–∞–¥–æ–≤–∏–π –±—É–¥–∏–Ω–æ–∫</option>
                        <option value="tehpasport-vvedennya">–ù–∞ –±—É–¥–∏–Ω–æ–∫ –¥–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è –≤ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é</option>
                        <option value="tehpasport-nezhyle">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –Ω–µ–∂–∏–ª–µ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è</option>
                        <option value="tehpasport-vyrobnychi">–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –≤–∏—Ä–æ–±–Ω–∏—á—ñ –±—É–¥—ñ–≤–ª—ñ</option>
                    </optgroup>
                    <optgroup label="–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è">
                        <option value="tehpasport-pereplanuvannya-kvartyra">–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –∫–≤–∞—Ä—Ç–∏—Ä–∏</option>
                        <option value="tehpasport-pereplanuvannya-budynok">–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –±—É–¥–∏–Ω–∫—É</option>
                        <option value="tehpasport-pereplanuvannya-vyrobnychi">–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –≤–∏—Ä–æ–±–Ω–∏—á–æ—ó –±—É–¥—ñ–≤–ª—ñ</option>
                        <option value="tehpasport-pereplanuvannya-nezhyle">–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –Ω–µ–∂–∏–ª–æ–≥–æ –ø—Ä–∏–º—ñ—â–µ–Ω–Ω—è</option>
                    </optgroup>
                    <optgroup label="–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ—Å–ª—É–≥–∏">
                        <option value="ocinka">–û—Ü—ñ–Ω–∫–∞ –Ω–µ—Ä—É—Ö–æ–º–æ–≥–æ –º–∞–π–Ω–∞</option>
                        <option value="budivelnyi-pasport">–ë—É–¥—ñ–≤–µ–ª—å–Ω–∏–π –ø–∞—Å–ø–æ—Ä—Ç</option>
                        <option value="tehnichne-obstezhennya">–¢–µ—Ö–Ω—ñ—á–Ω–µ –æ–±—Å—Ç–µ–∂–µ–Ω–Ω—è –±—É–¥—ñ–≤–µ–ª—å —Ç–∞ —Å–ø–æ—Ä—É–¥</option>
                        <option value="perevedennya-dachnogo">–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è –¥–∞—á–Ω–æ–≥–æ –±—É–¥–∏–Ω–∫—É –≤ –∂–∏–ª–∏–π</option>
                    </optgroup>
                </select>
            </div>

            <div class="card" id="table-editor" style="display: none;">
                <h3>–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–∞–±–ª–∏—Ü—ñ</h3>
                <input type="text" id="service-title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ (–Ω–∞–ø—Ä. –¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç –Ω–∞ –∫–≤–∞—Ä—Ç–∏—Ä—É)">
                
                <div id="table-container"></div>
                
                <button type="button" class="action-btn add-row-btn" onclick="addTableRow('', '')">+ –î–æ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫</button>
                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #e2e8f0;">
                <button type="button" class="action-btn" onclick="saveServiceData()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–∞–±–ª–∏—Ü—é</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://127.0.0.1:8000/api';

        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sidebar button').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            if (tabId === 'tab-faq') loadFaqs();
        }

        function showStatus(msg) {
            const el = document.getElementById('status-msg');
            el.textContent = msg; el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        // --- HERO ---
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const res = await fetch(`${API_URL}/settings/hero`);
                const data = await res.json();
                document.getElementById('hero-text').value = data.subtitle;
            } catch(e) { console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è Hero:", e); }
        });
        document.getElementById('hero-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            await fetch(`${API_URL}/settings/hero/update`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ subtitle: document.getElementById('hero-text').value }) });
            showStatus('–¢–µ–∫—Å—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
        });

        // --- FAQ ---
        async function loadFaqs() {
            const res = await fetch(`${API_URL}/faqs`);
            const faqs = await res.json();
            const list = document.getElementById('faq-list');
            list.innerHTML = '';
            faqs.forEach(f => {
                list.innerHTML += `<div class="faq-list-item"><button class="action-btn del-btn" onclick="deleteFaq(${f.id})">–í–∏–¥–∞–ª–∏—Ç–∏</button><strong>${f.question}</strong><p>${f.answer}</p></div>`;
            });
        }
        document.getElementById('faq-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            await fetch(`${API_URL}/faqs`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ question: document.getElementById('faq-q').value, answer: document.getElementById('faq-a').value }) });
            document.getElementById('faq-q').value = ''; document.getElementById('faq-a').value = '';
            showStatus('–ü–∏—Ç–∞–Ω–Ω—è –¥–æ–¥–∞–Ω–æ!'); loadFaqs();
        });
        async function deleteFaq(id) {
            if(confirm("–¢–æ—á–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏?")) { await fetch(`${API_URL}/faqs/${id}`, { method: 'DELETE' }); showStatus('–í–∏–¥–∞–ª–µ–Ω–æ!'); loadFaqs(); }
        }

        // --- –ü–û–°–õ–£–ì–ò –¢–ê –¶–Ü–ù–ò ---
        let currentSlug = '';

        async function loadServiceData() {
            currentSlug = document.getElementById('service-select').value;
            if(!currentSlug) return;
            
            document.getElementById('table-editor').style.display = 'block';
            try {
                const res = await fetch(`${API_URL}/services/${currentSlug}`);
                const data = await res.json();
                
                document.getElementById('service-title').value = data.title;
                const container = document.getElementById('table-container');
                container.innerHTML = ''; 
                
                const tableData = data.table_data && data.table_data.length > 0 ? data.table_data : [["–ü–æ—Å–ª—É–≥–∞", "–¶—ñ–Ω–∞"]];
                
                tableData.forEach((row, index) => {
                    addTableRow(row[0], row[1], index === 0);
                });
            } catch(e) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ:", e);
                showStatus("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö");
            }
        }

        function addTableRow(col1Val = '', col2Val = '', isHeader = false) {
            const container = document.getElementById('table-container');
            const rowDiv = document.createElement('div');
            rowDiv.className = `price-row ${isHeader ? 'header-row' : ''}`;
            
            rowDiv.innerHTML = `
                <input type="text" class="col-name" value="${col1Val}" placeholder="${isHeader ? '–ù–∞–∑–≤–∞ –∫–æ–ª–æ–Ω–∫–∏ 1' : '–ù–∞–∑–≤–∞ –ø–æ—Å–ª—É–≥–∏'}">
                <input type="text" class="col-price" value="${col2Val}" placeholder="${isHeader ? '–ù–∞–∑–≤–∞ –∫–æ–ª–æ–Ω–∫–∏ 2' : '–¶—ñ–Ω–∞'}">
                ${!isHeader ? '<button type="button" class="action-btn del-btn" onclick="this.parentElement.remove()">X</button>' : '<div style="width: 44px;"></div>'}
            `;
            container.appendChild(rowDiv);
        }

        async function saveServiceData() {
            try {
                console.log("–ü–æ—á–∏–Ω–∞—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è..."); // –î–µ–±–∞–≥
                const title = document.getElementById('service-title').value;
                const rows = document.querySelectorAll('.price-row');
                const tableData = [];
                
                rows.forEach(row => {
                    const col1 = row.querySelector('.col-name').value;
                    const col2 = row.querySelector('.col-price').value;
                    tableData.push([col1, col2]); // –¢–ï–ü–ï–† –¢–£–¢ –¢–û–ß–ù–û PUSH
                });

                console.log("–ó—ñ–±—Ä–∞–Ω—ñ –¥–∞–Ω—ñ:", title, tableData); // –î–µ–±–∞–≥

                const response = await fetch(`${API_URL}/services/${currentSlug}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: title, table_data: tableData })
                });

                if (response.ok) {
                    showStatus('–¢–∞–±–ª–∏—Ü—é —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –±–∞–∑—ñ!');
                } else {
                    showStatus('–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ.');
                }
            } catch (error) {
                console.error("–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ:", error);
                alert("–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞ –≤ —Å–∫—Ä–∏–ø—Ç—ñ! –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å F12, —â–æ–± –ø–æ–¥–∏–≤–∏—Ç–∏—Å—è –≤–∫–ª–∞–¥–∫—É Console.");
            }
        }
    </script>
</body>
</html>